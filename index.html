<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المحاسب الذكي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --secondary: #4cc9f0;
            --success: #4ade80;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --light: #f8fafc;
            --dark: #1e293b;
            --gray: #64748b;
            --border: #e2e8f0;
            --card-bg: #ffffff;
            --bg-color: #f1f5f9;
            --text-color: #1e293b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 12px;
        }

        .dark-theme {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #f1f5f9;
            --border: #334155;
            --light: #1e293b;
            --dark: #f8fafc;
            --gray: #94a3b8;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: all 0.3s ease;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            min-height: 100vh;
        }

        .status-bar {
            background: var(--primary);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .developer-info {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 11px;
        }

        .status-bar .date {
            font-weight: 500;
        }

        .status-bar .time {
            font-weight: 600;
        }

        .search-bar {
            background: var(--card-bg);
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .search-container {
            position: relative;
            max-width: 100%;
        }

        .search-container input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border-radius: 25px;
            border: 1px solid var(--border);
            background: var(--light);
            color: var(--text-color);
            font-size: 16px;
            transition: all 0.3s;
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .search-container i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding: 15px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            border: 1px solid var(--border);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0 5px;
            color: var(--primary);
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .stat-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        .section {
            margin: 20px 15px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
        }

        .section-link {
            color: var(--primary);
            font-size: 14px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }

        .action-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
            transition: all 0.3s;
            border: 1px solid var(--border);
            cursor: pointer;
        }

        .action-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .action-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            color: var(--primary);
            font-size: 20px;
        }

        .action-name {
            font-size: 13px;
            font-weight: 500;
        }

        .finance-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .finance-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s;
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            cursor: pointer;
        }

        .finance-card:hover {
            transform: translateY(-3px);
        }

        .finance-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: var(--primary);
            font-size: 24px;
        }

        .finance-value {
            font-size: 22px;
            font-weight: 700;
            margin: 5px 0;
            color: var(--primary);
        }

        .finance-label {
            font-size: 14px;
            color: var(--gray);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            border-top: 1px solid var(--border);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--gray);
            font-size: 12px;
            transition: all 0.3s;
            flex: 1;
            padding: 5px 0;
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }

        .nav-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }

        .page {
            display: none;
            padding: 15px;
            padding-bottom: 70px;
        }

        .page.active {
            display: block;
        }

        .page-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
        }

        .back-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 18px;
            cursor: pointer;
        }

        .list-container {
            background: var(--card-bg);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .list-item {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.3s;
            cursor: pointer;
        }

        .list-item:last-child {
            border-bottom: none;
        }

        .list-item:hover {
            background: var(--light);
        }

        .item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .item-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(67, 97, 238, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
        }

        .item-details {
            display: flex;
            flex-direction: column;
        }

        .item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .item-desc {
            font-size: 13px;
            color: var(--gray);
        }

        .item-value {
            font-weight: 600;
            color: var(--primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            gap: 8px;
            text-decoration: none;
        }

        .btn:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
        }

        .btn-block {
            width: 100%;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #22c55e;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #eab308;
        }

        .btn-danger {
            background: var(--danger);
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 16px;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
            font-weight: 600;
            font-size: 18px;
        }

        .card-header i {
            color: var(--primary);
        }

        .theme-toggle {
            position: fixed;
            bottom: 80px;
            right: 15px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--card-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            box-shadow: var(--shadow);
            z-index: 1001;
            cursor: pointer;
            border: 2px solid var(--primary);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 25px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: var(--gray);
            cursor: pointer;
        }

        .login-container {
            max-width: 450px;
            margin: 50px auto;
            background: var(--card-bg);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .login-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .login-body {
            padding: 25px;
        }

        .login-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 15px;
        }

        .login-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-option:hover {
            background: var(--light);
            transform: translateY(-2px);
        }

        .login-option i {
            font-size: 20px;
            color: var(--primary);
        }

        .login-option-text {
            flex: 1;
        }

        .login-option-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .login-option-desc {
            color: var(--gray);
            font-size: 13px;
        }

        .login-footer {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--gray);
            font-size: 14px;
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .records-table th, .records-table td {
            border: 1px solid var(--border);
            padding: 10px;
            text-align: center;
        }

        .records-table th {
            background: var(--primary);
            color: white;
            font-weight: 600;
        }

        .records-table tr:nth-child(even) {
            background: var(--light);
        }

        .contacts-modal .modal-content {
            max-width: 400px;
        }

        .contacts-list {
            max-height: 400px;
            overflow-y: auto;
            margin: 15px 0;
        }

        .contact-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.3s;
        }

        .contact-item:last-child {
            border-bottom: none;
        }

        .contact-item:hover {
            background: var(--light);
        }

        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-left: 12px;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .contact-phone {
            color: var(--gray);
            font-size: 13px;
        }

        @media (max-width: 480px) {
            .stats-grid, .quick-actions, .finance-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card, .action-card, .finance-card {
                padding: 15px;
            }
            
            .section {
                margin: 15px 10px;
            }
            
            .developer-info {
                display: none;
            }
        }

        @media (min-width: 768px) {
            .app-container {
                max-width: 500px;
                margin: 0 auto;
                box-shadow: 0 0 20px rgba(0,0,0,0.1);
                min-height: 100vh;
                position: relative;
            }
            
            .bottom-nav {
                max-width: 500px;
                margin: 0 auto;
                left: 50%;
                transform: translateX(-50%);
            }
        }

        .contacts-btn {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
            margin-right: 5px;
        }
        
        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        
        .client-actions {
            display: flex;
            gap: 5px;
        }

        .developer-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            z-index: 3000;
            text-align: center;
            max-width: 300px;
            border: 2px solid var(--primary);
        }

        .developer-notification h3 {
            color: var(--primary);
            margin-bottom: 10px;
        }

        .developer-notification p {
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .developer-notification .btn {
            margin-top: 10px;
        }
        
        .delivered-amount {
            background: var(--success);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .delivered-amount i {
            font-size: 12px;
        }
        
        .amount-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }
        
        .amount-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .amount-input-group .form-control {
            flex: 1;
        }
        
        .debtor-item, .supplier-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            transition: background 0.3s;
        }
        
        .debtor-item:hover, .supplier-item:hover {
            background: var(--light);
        }
        
        .debtor-avatar, .supplier-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-left: 12px;
        }
        
        .debtor-info, .supplier-info {
            flex: 1;
        }
        
        .debtor-name, .supplier-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .debtor-details, .supplier-details {
            font-size: 13px;
            color: var(--gray);
        }
        
        .debt-amount {
            font-weight: 600;
            color: var(--danger);
        }
        
        .credit-amount {
            font-weight: 600;
            color: var(--success);
        }
        
        .transaction-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }
        
        .transaction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }
        
        .transaction-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .transaction-number {
            font-size: 14px;
            color: var(--gray);
        }
        
        .transaction-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .transaction-items {
            margin-top: 15px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px dashed var(--border);
        }
        
        .transaction-total {
            display: flex;
            justify-content: space-between;
            padding: 15px 0;
            font-weight: 600;
            font-size: 18px;
            border-top: 2px solid var(--primary);
            margin-top: 10px;
        }
        
        .balance-info {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: var(--light);
            border-radius: var(--radius);
            margin-top: 15px;
            font-weight: 600;
        }
        
        .balance-label {
            color: var(--gray);
        }
        
        .balance-amount {
            color: var(--primary);
        }
        
        .balance-positive {
            color: var(--success);
        }
        
        .balance-negative {
            color: var(--danger);
        }
    </style>
</head>
<body>
    <div id="login-page" class="login-container">
        <div class="login-header">
            <h1><i class="fas fa-calculator"></i> نظام المحاسب الذكي</h1>
            <p>سجل الدخول لبدء استخدام النظام المحاسبي المتكامل</p>
            <div class="developer-info">مطور بواسطة: عبد الوهاب عبد الواحد الريمي</div>
        </div>
        <div class="login-body">
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-control" id="loginEmail" placeholder="أدخل بريدك الإلكتروني" required>
                </div>
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-control" id="loginPassword" placeholder="أدخل كلمة المرور" required>
                </div>
                <button type="submit" class="btn btn-block">تسجيل الدخول</button>
            </form>
            
            <div style="text-align: center; margin: 20px 0; color: var(--gray);">أو سجل الدخول باستخدام</div>
            
            <div class="login-options">
                <div class="login-option" onclick="loginWithGoogle()">
                    <i class="fab fa-google"></i>
                    <div class="login-option-text">
                        <div class="login-option-title">تسجيل الدخول بحساب جوجل</div>
                        <div class="login-option-desc">استخدم حساب جوجل الخاص بك</div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>

                <div class="login-option" onclick="loginAsGuest()">
                    <i class="fas fa-user"></i>
                    <div class="login-option-text">
                        <div class="login-option-title">الدخول كضيف</div>
                        <div class="login-option-desc">استخدم التطبيق بدون تسجيل</div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
            </div>
            
            <div class="login-footer">
                <p>ليس لديك حساب؟ <a href="#" onclick="showRegisterModal()">إنشاء حساب جديد</a></p>
                <p style="margin-top: 10px;">مطور بواسطة: عبد الوهاب عبد الواحد الريمي</p>
            </div>
        </div>
    </div>

    <div class="app-container" id="main-app" style="display: none;">
        <div class="status-bar">
            <div class="developer-info">مطور بواسطة: عبد الوهاب عبد الواحد الريمي</div>
            <div class="date" id="currentDate">السبت، ١٨ أكتوبر ٢٠٢٥</div>
            <div class="time" id="currentTime">10:30 ص</div>
        </div>

        <div class="search-bar">
            <div class="search-container">
                <input type="text" placeholder="ابحث في التطبيق..." id="searchInput">
                <i class="fas fa-search"></i>
            </div>
        </div>

        <div id="home-page" class="page active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">الإيرادات</div>
                    <div class="stat-value" id="revenueValue">0.00</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="revenueChange">0% عن الشهر الماضي</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">المصروفات</div>
                    <div class="stat-value" id="expensesValue">0.00</div>
                    <div class="stat-change negative">
                        <i class="fas fa-arrow-down"></i>
                        <span id="expensesChange">0% عن الشهر الماضي</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">صافي الربح</div>
                    <div class="stat-value" id="profitValue">0.00</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="profitChange">0% عن الشهر الماضي</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">رصيد الخزينة</div>
                    <div class="stat-value" id="balanceValue">0.00</div>
                    <div class="stat-change positive">
                        <i class="fas fa-arrow-up"></i>
                        <span id="balanceChange">0% عن الشهر الماضي</span>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">العمليات السريعة</div>
                    <a href="#" class="section-link" onclick="showPage('transactions')">عرض الكل <i class="fas fa-chevron-left"></i></a>
                </div>
                <div class="quick-actions">
                    <div class="action-card" onclick="showInvoiceModal()">
                        <div class="action-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="action-name">فاتورة جديدة</div>
                    </div>
                    <div class="action-card" onclick="showVoucherModal()">
                        <div class="action-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="action-name">سند جديد</div>
                    </div>
                    <div class="action-card" onclick="showTransferModal()">
                        <div class="action-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="action-name">حوالة جديدة</div>
                    </div>
                    <div class="action-card" onclick="accessDeviceContacts()">
                        <div class="action-icon">
                            <i class="fas fa-address-book"></i>
                        </div>
                        <div class="action-name">جهات الاتصال</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">الإدارة المالية</div>
                    <a href="#" class="section-link" onclick="showPage('management')">عرض الكل <i class="fas fa-chevron-left"></i></a>
                </div>
                <div class="finance-grid">
                    <div class="finance-card" onclick="showPage('clients')">
                        <div class="finance-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="finance-value" id="clientsCount">0</div>
                        <div class="finance-label">العملاء</div>
                    </div>
                    <div class="finance-card" onclick="showPage('suppliers')">
                        <div class="finance-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="finance-value" id="suppliersCount">0</div>
                        <div class="finance-label">الموردين</div>
                    </div>
                    <div class="finance-card" onclick="showPage('debts')">
                        <div class="finance-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <div class="finance-value" id="debtsCount">0</div>
                        <div class="finance-label">الديون</div>
                    </div>
                    <div class="finance-card" onclick="showPage('employees')">
                        <div class="finance-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="finance-value" id="employeesCount">0</div>
                        <div class="finance-label">الموظفين</div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <div class="section-title">المبالغ المسلمة</div>
                    <a href="#" class="section-link" onclick="showDeliveredAmounts()">عرض الكل <i class="fas fa-chevron-left"></i></a>
                </div>
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-money-bill-wave"></i> إضافة مبلغ مسلم
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">المبلغ</label>
                            <input type="number" class="form-control" id="amountValue" placeholder="أدخل المبلغ" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">العميل (اختياري)</label>
                            <select class="form-control" id="amountClient">
                                <option value="">اختر العميل</option>
                            </select>
                        </div>
                        <button class="btn btn-block" onclick="addDeliveredAmount()">
                            <i class="fas fa-plus"></i> إضافة مبلغ مسلم
                        </button>
                    </div>
                </div>
                
                <div class="list-container" id="deliveredAmountsList">
                </div>
            </div>
        </div>

        <div id="clients-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('home')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title">العملاء</div>
            </div>

            <button class="btn btn-block" onclick="showClientModal()">
                <i class="fas fa-plus"></i> إضافة عميل جديد
            </button>
            
            <button class="btn btn-outline btn-block" onclick="accessDeviceContacts()" style="margin-top: 10px;">
                <i class="fas fa-address-book"></i> الوصول إلى جهات اتصال الجهاز
            </button>

            <div class="list-container" id="clientsList">
            </div>
        </div>

        <div id="client-records-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('clients')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title" id="clientRecordsTitle">سجل العميل</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-plus-circle"></i> إضافة معاملة جديدة
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">اسم الصنف</label>
                        <input type="text" class="form-control" id="itemName" placeholder="أدخل اسم الصنف">
                    </div>
                    <div class="form-group">
                        <label class="form-label">القيمة</label>
                        <input type="number" class="form-control" id="itemValue" placeholder="أدخل القيمة" step="0.01">
                    </div>
                    <button class="btn btn-block" onclick="addClientRecord()">
                        <i class="fas fa-plus"></i> إضافة
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-history"></i> سجل المعاملات
                </div>
                <div class="card-body">
                    <table class="records-table">
                        <thead>
                            <tr>
                                <th>اسم الصنف</th>
                                <th>القيمة</th>
                                <th>التاريخ</th>
                                <th>النقاط</th>
                                <th>خيارات</th>
                            </tr>
                        </thead>
                        <tbody id="clientRecordsTable">
                        </tbody>
                    </table>
                    <div class="total" id="clientTotal">الإجمالي: 0.00</div>
                    
                    <div class="balance-info">
                        <span class="balance-label">الرصيد المتبقي:</span>
                        <span class="balance-amount" id="clientBalance">0.00 ر.س</span>
                    </div>
                    
                    <div class="btn-group" style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-success" onclick="sendClientStatement('whatsapp')">
                            <i class="fab fa-whatsapp"></i>   
                        </button>
                        <button class="btn btn-info" onclick="sendClientStatement('sms')">
                            <i class="fas fa-sms"></i>   
                        </button>
                        <button class="btn btn-danger" onclick="deleteClientAccount()">
                            <i class="fas fa-trash"></i>   
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-money-bill-wave"></i> المبالغ المسلمة للعميل
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">المبلغ</label>
                        <input type="number" class="form-control" id="clientAmountValue" placeholder="أدخل المبلغ" step="0.01">
                    </div>
                    <button class="btn btn-block" onclick="addClientDeliveredAmount()">
                        <i class="fas fa-plus"></i> إضافة مبلغ مسلم
                    </button>
                    
                    <div class="list-container" id="clientDeliveredAmountsList" style="margin-top: 15px;">
                    </div>
                </div>
            </div>
        </div>

        <div id="suppliers-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('home')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title">الموردين</div>
            </div>

            <button class="btn btn-block" onclick="showSupplierModal()">
                <i class="fas fa-plus"></i> إضافة مورد جديد
            </button>

            <div class="list-container" id="suppliersList">
            </div>
        </div>

        <div id="debts-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('home')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title">الديون</div>
            </div>

            <button class="btn btn-block" onclick="showDebtorModal()">
                <i class="fas fa-plus"></i> إضافة مدين جديد
            </button>

            <div class="list-container" id="debtorsList">
            </div>
        </div>

        <div id="employees-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('home')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title">الموظفين</div>
            </div>

            <button class="btn btn-block" onclick="showEmployeeModal()">
                <i class="fas fa-plus"></i> إضافة موظف جديد
            </button>

            <div class="list-container" id="employeesList">
            </div>
        </div>

        <div id="employee-records-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('employees')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title" id="employeeRecordsTitle">سجل الموظف</div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-plus-circle"></i> إضافة معاملة جديدة
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">اسم الصنف</label>
                        <input type="text" class="form-control" id="employeeItemName" placeholder="أدخل اسم الصنف">
                    </div>
                    <div class="form-group">
                        <label class="form-label">القيمة</label>
                        <input type="number" class="form-control" id="employeeItemValue" placeholder="أدخل القيمة" step="0.01">
                    </div>
                    <button class="btn btn-block" onclick="addEmployeeRecord()">
                        <i class="fas fa-plus"></i> إضافة
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <i class="fas fa-history"></i> سجل المعاملات
                </div>
                <div class="card-body">
                    <table class="records-table">
                        <thead>
                            <tr>
                                <th>اسم الصنف</th>
                                <th>القيمة</th>
                                <th>التاريخ</th>
                                <th>النقاط</th>
                                <th>خيارات</th>
                            </tr>
                        </thead>
                        <tbody id="employeeRecordsTable">
                        </tbody>
                    </table>
                    <div class="total" id="employeeTotal">الإجمالي: 0.00</div>
                    
                    <div class="btn-group" style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn btn-danger" onclick="deleteEmployeeAccount()">
                            <i class="fas fa-trash"></i> حذف الحساب
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div id="reports-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('home')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title">التقارير</div>
            </div>

            <div class="list-container">
                <div class="list-item" onclick="generateReport('clients')">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">تقرير العملاء</div>
                            <div class="item-desc">عرض تقرير مفصل عن العملاء</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="generateReport('financial')">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">تقرير مالي</div>
                            <div class="item-desc">عرض التقرير المالي الشامل</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="generateReport('debts')">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">تقرير المديونيات</div>
                            <div class="item-desc">عرض تقرير المديونيات</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="generateReport('employees')">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">تقرير الموظفين</div>
                            <div class="item-desc">عرض تقرير الموظفين والرواتب</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
            </div>
        </div>

        <div id="settings-page" class="page">
            <div class="page-header">
                <div class="back-button" onclick="showPage('home')">
                    <i class="fas fa-arrow-right"></i>
                </div>
                <div class="page-title">الإعدادات</div>
            </div>

            <div class="list-container">
                <div class="list-item" onclick="toggleTheme()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-palette"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">المظهر</div>
                            <div class="item-desc">تبديل الوضع الداكن/الفاتح</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="accessDeviceContacts()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-address-book"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">جهات اتصال الجهاز</div>
                            <div class="item-desc">الوصول إلى جهات اتصال جهازك</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="showContactsModal()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-address-book"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">جهات الاتصال المحفوظة</div>
                            <div class="item-desc">الوصول إلى جهات الاتصال المحفوظة</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="accessDrive()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fab fa-google-drive"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">التخزين السحابي</div>
                            <div class="item-desc">الوصول إلى Google Drive</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="createBackup()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">نسخ احتياطي</div>
                            <div class="item-desc">إنشاء نسخة احتياطية من البيانات</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="restoreBackup()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-upload"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">استعادة بيانات</div>
                            <div class="item-desc">استعادة البيانات من نسخة احتياطية</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="deleteAllData()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-trash"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">حذف جميع البيانات</div>
                            <div class="item-desc">حذف جميع السجلات والمعلومات</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
                <div class="list-item" onclick="logout()">
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-sign-out-alt"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">تسجيل الخروج</div>
                            <div class="item-desc">تسجيل الخروج من التطبيق</div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-left"></i>
                </div>
            </div>
            
            <div class="login-footer" style="margin-top: 20px;">
                <p>مطور بواسطة: عبد الوهاب عبد الواحد الريمي</p>
            </div>
        </div>

        <div class="theme-toggle" id="themeToggle">
            <i class="fas fa-moon" id="themeIcon"></i>
        </div>

        <div class="bottom-nav">
            <div class="nav-item active" onclick="showPage('home')">
                <i class="fas fa-home nav-icon"></i>
                <span>الرئيسية</span>
            </div>
            <div class="nav-item" onclick="showPage('clients')">
                <i class="fas fa-users nav-icon"></i>
                <span>العملاء</span>
            </div>
            <div class="nav-item" onclick="showPage('suppliers')">
                <i class="fas fa-truck nav-icon"></i>
                <span>الموردين</span>
            </div>
            <div class="nav-item" onclick="showPage('debts')">
                <i class="fas fa-file-invoice-dollar nav-icon"></i>
                <span>الديون</span>
            </div>
            <div class="nav-item" onclick="showPage('employees')">
                <i class="fas fa-user-tie nav-icon"></i>
                <span>الموظفين</span>
            </div>
            <div class="nav-item" onclick="showPage('reports')">
                <i class="fas fa-chart-bar nav-icon"></i>
                <span>التقارير</span>
            </div>
            <div class="nav-item" onclick="showPage('settings')">
                <i class="fas fa-cog nav-icon"></i>
                <span>الإعدادات</span>
            </div>
        </div>
    </div>

    <div class="modal" id="clientModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة عميل جديد</div>
                <button class="modal-close" onclick="closeModal('clientModal')">&times;</button>
            </div>
            <form id="clientForm">
                <div class="form-group">
                    <label class="form-label">اسم العميل</label>
                    <input type="text" class="form-control" id="clientName" placeholder="أدخل اسم العميل" required>
                </div>
                <div class="form-group">
                    <label class="form-label">رقم الهاتف</label>
                    <input type="text" class="form-control" id="clientPhone" placeholder="أدخل رقم الهاتف" required>
                </div>
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-control" id="clientEmail" placeholder="أدخل البريد الإلكتروني">
                </div>
                <div class="form-group">
                    <label class="form-label">العنوان</label>
                    <textarea class="form-control" id="clientAddress" placeholder="أدخل عنوان العميل" rows="2"></textarea>
                </div>
                <button type="submit" class="btn btn-block">حفظ العميل</button>
            </form>
        </div>
    </div>

    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة موظف جديد</div>
                <button class="modal-close" onclick="closeModal('employeeModal')">&times;</button>
            </div>
            <form id="employeeForm">
                <div class="form-group">
                    <label class="form-label">اسم الموظف</label>
                    <input type="text" class="form-control" id="employeeName" placeholder="أدخل اسم الموظف" required>
                </div>
                <div class="form-group">
                    <label class="form-label">رقم الهاتف</label>
                    <input type="text" class="form-control" id="employeePhone" placeholder="أدخل رقم الهاتف" required>
                </div>
                <div class="form-group">
                    <label class="form-label">الراتب</label>
                    <input type="number" class="form-control" id="employeeSalary" placeholder="أدخل الراتب" required step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">المسمى الوظيفي</label>
                    <input type="text" class="form-control" id="employeePosition" placeholder="أدخل المسمى الوظيفي" required>
                </div>
                <button type="submit" class="btn btn-block">حفظ الموظف</button>
            </form>
        </div>
    </div>

    <div class="modal" id="supplierModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة مورد جديد</div>
                <button class="modal-close" onclick="closeModal('supplierModal')">&times;</button>
            </div>
            <form id="supplierForm">
                <div class="form-group">
                    <label class="form-label">اسم المورد</label>
                    <input type="text" class="form-control" id="supplierName" placeholder="أدخل اسم المورد" required>
                </div>
                <div class="form-group">
                    <label class="form-label">رقم الهاتف</label>
                    <input type="text" class="form-control" id="supplierPhone" placeholder="أدخل رقم الهاتف" required>
                </div>
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-control" id="supplierEmail" placeholder="أدخل البريد الإلكتروني">
                </div>
                <div class="form-group">
                    <label class="form-label">العنوان</label>
                    <textarea class="form-control" id="supplierAddress" placeholder="أدخل عنوان المورد" rows="2"></textarea>
                </div>
                <button type="submit" class="btn btn-block">حفظ المورد</button>
            </form>
        </div>
    </div>

    <div class="modal" id="debtorModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إضافة مدين جديد</div>
                <button class="modal-close" onclick="closeModal('debtorModal')">&times;</button>
            </div>
            <form id="debtorForm">
                <div class="form-group">
                    <label class="form-label">اسم المدين</label>
                    <input type="text" class="form-control" id="debtorName" placeholder="أدخل اسم المدين" required>
                </div>
                <div class="form-group">
                    <label class="form-label">رقم الهاتف</label>
                    <input type="text" class="form-control" id="debtorPhone" placeholder="أدخل رقم الهاتف" required>
                </div>
                <div class="form-group">
                    <label class="form-label">المبلغ المدين به</label>
                    <input type="number" class="form-control" id="debtorAmount" placeholder="أدخل المبلغ المدين به" required step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">تاريخ الاستحقاق</label>
                    <input type="date" class="form-control" id="debtorDueDate" required>
                </div>
                <button type="submit" class="btn btn-block">حفظ المدين</button>
            </form>
        </div>
    </div>

    <div class="modal" id="invoiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">فاتورة بيع جديدة</div>
                <button class="modal-close" onclick="closeModal('invoiceModal')">&times;</button>
            </div>
            <form id="invoiceForm">
                <div class="form-group">
                    <label class="form-label">العميل</label>
                    <select class="form-control" id="invoiceClient" required>
                        <option value="">اختر العميل</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">تاريخ الفاتورة</label>
                    <input type="date" class="form-control" id="invoiceDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">عناصر الفاتورة</label>
                    <div id="invoiceItems">
                        <div class="amount-input-group">
                            <input type="text" class="form-control" placeholder="اسم الصنف">
                            <input type="number" class="form-control" placeholder="الكمية" step="1">
                            <input type="number" class="form-control" placeholder="السعر" step="0.01">
                            <button type="button" class="btn btn-outline" onclick="addInvoiceItem()">+</button>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-block">إنشاء الفاتورة</button>
            </form>
        </div>
    </div>

    <div class="modal" id="voucherModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">سند جديد</div>
                <button class="modal-close" onclick="closeModal('voucherModal')">&times;</button>
            </div>
            <form id="voucherForm">
                <div class="form-group">
                    <label class="form-label">نوع السند</label>
                    <select class="form-control" id="voucherType" required>
                        <option value="">اختر نوع السند</option>
                        <option value="قبض">سند قبض</option>
                        <option value="صرف">سند صرف</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">المبلغ</label>
                    <input type="number" class="form-control" id="voucherAmount" placeholder="أدخل المبلغ" required step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">تاريخ السند</label>
                    <input type="date" class="form-control" id="voucherDate" required>
                </div>
                <button type="submit" class="btn btn-block">إنشاء السند</button>
            </form>
        </div>
    </div>

    <div class="modal" id="transferModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">حوالة جديدة</div>
                <button class="modal-close" onclick="closeModal('transferModal')">&times;</button>
            </div>
            <form id="transferForm">
                <div class="form-group">
                    <label class="form-label">من</label>
                    <input type="text" class="form-control" id="transferFrom" placeholder="أدخل اسم المرسل" required>
                </div>
                <div class="form-group">
                    <label class="form-label">إلى</label>
                    <input type="text" class="form-control" id="transferTo" placeholder="أدخل اسم المستلم" required>
                </div>
                <div class="form-group">
                    <label class="form-label">المبلغ</label>
                    <input type="number" class="form-control" id="transferAmount" placeholder="أدخل المبلغ" required step="0.01">
                </div>
                <div class="form-group">
                    <label class="form-label">تاريخ الحوالة</label>
                    <input type="date" class="form-control" id="transferDate" required>
                </div>
                <button type="submit" class="btn btn-block">إنشاء الحوالة</button>
            </form>
        </div>
    </div>

    <div class="modal contacts-modal" id="contactsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title"><i class="fas fa-address-book"></i> جهات الاتصال المحفوظة</div>
                <button class="modal-close" onclick="closeModal('contactsModal')">&times;</button>
            </div>
            <div class="form-group">
                <input type="text" class="form-control" id="contactSearch" placeholder="ابحث في جهات الاتصال..." oninput="filterContacts()">
            </div>
            <div class="contacts-list" id="contactsList">
            </div>
            <div class="form-group">
                <button class="btn btn-block" onclick="addNewContact()">
                    <i class="fas fa-plus"></i> إضافة جهة اتصال جديدة
                </button>
            </div>
        </div>
    </div>

    <div class="modal" id="registerModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">إنشاء حساب جديد</div>
                <button class="modal-close" onclick="closeModal('registerModal')">&times;</button>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label class="form-label">الاسم الكامل</label>
                    <input type="text" class="form-control" id="registerName" placeholder="أدخل اسمك الكامل" required>
                </div>
                <div class="form-group">
                    <label class="form-label">البريد الإلكتروني</label>
                    <input type="email" class="form-control" id="registerEmail" placeholder="أدخل بريدك الإلكتروني" required>
                </div>
                <div class="form-group">
                    <label class="form-label">كلمة المرور</label>
                    <input type="password" class="form-control" id="registerPassword" placeholder="أنشئ كلمة مرور" required>
                </div>
                <div class="form-group">
                    <label class="form-label">تأكيد كلمة المرور</label>
                    <input type="password" class="form-control" id="registerConfirmPassword" placeholder="أعد إدخال كلمة المرور" required>
                </div>
                <button type="submit" class="btn btn-block">إنشاء الحساب</button>
            </form>
            <div class="login-footer">
                <p>مطور بواسطة: عبد الوهاب عبد الواحد الريمي</p>
            </div>
        </div>
    </div>

    <div class="developer-notification" id="developerNotification" style="display: none;">
        <h3><i class="fas fa-code"></i> معلومات المطور</h3>
        <p>تم تطوير هذا التطبيق بواسطة:</p>
        <p><strong>عبد الوهاب عبد الواحد الريمي</strong></p>
        <p>نظام المحاسب الذكي المتكامل</p>
        <button class="btn" onclick="closeDeveloperNotification()">موافق</button>
    </div>

    <script>
        let clients = {};
        let employees = {};
        let suppliers = {};
        let debtors = {};
        let contacts = [];
        let deliveredAmounts = [];
        let invoices = [];
        let vouchers = [];
        let transfers = [];
        let currentUser = null;
        let isDarkMode = false;
        let currentClient = null;
        let currentEmployee = null;

        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            updateDateTime();
            setInterval(updateDateTime, 60000);
            
            loadData();
            initTheme();
            checkLoginStatus();
            
            document.getElementById('loginForm').addEventListener('submit', login);
            document.getElementById('registerForm').addEventListener('submit', register);
            document.getElementById('clientForm').addEventListener('submit', addClient);
            document.getElementById('employeeForm').addEventListener('submit', addEmployee);
            document.getElementById('supplierForm').addEventListener('submit', addSupplier);
            document.getElementById('debtorForm').addEventListener('submit', addDebtor);
            document.getElementById('invoiceForm').addEventListener('submit', addInvoice);
            document.getElementById('voucherForm').addEventListener('submit', addVoucher);
            document.getElementById('transferForm').addEventListener('submit', addTransfer);
            
            document.getElementById('searchInput').addEventListener('input', searchData);
            
            setTimeout(showDeveloperNotification, 1000);
        }

        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            } else {
                showLoginScreen();
            }
        }

        function showLoginScreen() {
            document.getElementById('login-page').style.display = 'block';
            document.getElementById('main-app').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            updateStats();
            renderClients();
            renderEmployees();
            renderSuppliers();
            renderDebtors();
            loadContacts();
            renderDeliveredAmounts();
        }

        function login(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            currentUser = {
                email: email,
                name: email.split('@')[0],
                type: 'email'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainApp();
            alert('تم تسجيل الدخول بنجاح!');
            
            setTimeout(showDeveloperNotification, 500);
        }

        function register(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('كلمات المرور غير متطابقة!');
                return;
            }
            
            currentUser = {
                name: name,
                email: email,
                type: 'registered'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            closeModal('registerModal');
            showMainApp();
            alert('تم إنشاء الحساب بنجاح!');
            
            setTimeout(showDeveloperNotification, 500);
        }

        function loginWithGoogle() {
            currentUser = {
                name: 'مستخدم جوجل',
                email: 'user@gmail.com',
                type: 'google'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainApp();
            alert('تم تسجيل الدخول بحساب جوجل بنجاح!');
            
            setTimeout(showDeveloperNotification, 500);
        }

        function loginAsGuest() {
            currentUser = {
                name: 'ضيف',
                type: 'guest'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            showMainApp();
            alert('تم الدخول كضيف بنجاح!');
            
            setTimeout(showDeveloperNotification, 500);
        }

        function logout() {
            if (confirm('هل أنت متأكد من تسجيل الخروج؟')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showLoginScreen();
                alert('تم تسجيل الخروج بنجاح!');
            }
        }

        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString('ar-SA', options);
            const timeStr = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('currentTime').textContent = timeStr;
        }

        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                enableDarkMode();
            } else {
                enableLightMode();
            }
        }

        function enableDarkMode() {
            document.body.classList.add('dark-theme');
            document.getElementById('themeIcon').className = 'fas fa-sun';
            isDarkMode = true;
            localStorage.setItem('theme', 'dark');
        }

        function enableLightMode() {
            document.body.classList.remove('dark-theme');
            document.getElementById('themeIcon').className = 'fas fa-moon';
            isDarkMode = false;
            localStorage.setItem('theme', 'light');
        }

        function toggleTheme() {
            if (isDarkMode) {
                enableLightMode();
            } else {
                enableDarkMode();
            }
        }

        function loadData() {
            if(localStorage.getItem('clients')) {
                clients = JSON.parse(localStorage.getItem('clients'));
            }
            
            if(localStorage.getItem('employees')) {
                employees = JSON.parse(localStorage.getItem('employees'));
            }
            
            if(localStorage.getItem('suppliers')) {
                suppliers = JSON.parse(localStorage.getItem('suppliers'));
            }
            
            if(localStorage.getItem('debtors')) {
                debtors = JSON.parse(localStorage.getItem('debtors'));
            }
            
            if(localStorage.getItem('contacts')) {
                contacts = JSON.parse(localStorage.getItem('contacts'));
            }
            
            if(localStorage.getItem('deliveredAmounts')) {
                deliveredAmounts = JSON.parse(localStorage.getItem('deliveredAmounts'));
            }
            
            if(localStorage.getItem('invoices')) {
                invoices = JSON.parse(localStorage.getItem('invoices'));
            }
            
            if(localStorage.getItem('vouchers')) {
                vouchers = JSON.parse(localStorage.getItem('vouchers'));
            }
            
            if(localStorage.getItem('transfers')) {
                transfers = JSON.parse(localStorage.getItem('transfers'));
            }
        }

        function saveData() {
            localStorage.setItem('clients', JSON.stringify(clients));
            localStorage.setItem('employees', JSON.stringify(employees));
            localStorage.setItem('suppliers', JSON.stringify(suppliers));
            localStorage.setItem('debtors', JSON.stringify(debtors));
            localStorage.setItem('contacts', JSON.stringify(contacts));
            localStorage.setItem('deliveredAmounts', JSON.stringify(deliveredAmounts));
            localStorage.setItem('invoices', JSON.stringify(invoices));
            localStorage.setItem('vouchers', JSON.stringify(vouchers));
            localStorage.setItem('transfers', JSON.stringify(transfers));
            updateStats();
        }

        function updateStats() {
            document.getElementById('clientsCount').textContent = Object.keys(clients).length;
            document.getElementById('employeesCount').textContent = Object.keys(employees).length;
            document.getElementById('suppliersCount').textContent = Object.keys(suppliers).length;
            document.getElementById('debtsCount').textContent = Object.keys(debtors).length;
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(pageId + '-page').classList.add('active');
            
            if (pageId === 'home') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (pageId === 'clients') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            } else if (pageId === 'suppliers') {
                document.querySelectorAll('.nav-item')[2].classList.add('active');
            } else if (pageId === 'debts') {
                document.querySelectorAll('.nav-item')[3].classList.add('active');
            } else if (pageId === 'employees') {
                document.querySelectorAll('.nav-item')[4].classList.add('active');
            } else if (pageId === 'reports') {
                document.querySelectorAll('.nav-item')[5].classList.add('active');
            } else if (pageId === 'settings') {
                document.querySelectorAll('.nav-item')[6].classList.add('active');
            }
        }

        function showClientModal() {
            openModal('clientModal');
        }

        function showEmployeeModal() {
            openModal('employeeModal');
        }

        function showSupplierModal() {
            openModal('supplierModal');
        }

        function showDebtorModal() {
            openModal('debtorModal');
        }

        function showInvoiceModal() {
            const clientSelect = document.getElementById('invoiceClient');
            clientSelect.innerHTML = '<option value="">اختر العميل</option>';
            for (const client in clients) {
                const option = document.createElement('option');
                option.value = client;
                option.textContent = client;
                clientSelect.appendChild(option);
            }
            
            openModal('invoiceModal');
        }

        function showVoucherModal() {
            openModal('voucherModal');
        }

        function showTransferModal() {
            openModal('transferModal');
        }

        function showContactsModal() {
            openModal('contactsModal');
            renderContacts();
        }

        function showRegisterModal() {
            openModal('registerModal');
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            if (modalId !== 'contactsModal') {
                document.getElementById(modalId.replace('Modal', 'Form')).reset();
            }
        }

        function addClient(e) {
            e.preventDefault();
            
            const name = document.getElementById('clientName').value;
            const phone = document.getElementById('clientPhone').value;
            const email = document.getElementById('clientEmail').value;
            const address = document.getElementById('clientAddress').value;
            
            clients[name] = {
                phone: phone,
                email: email,
                address: address,
                joinDate: new Date().toISOString().split('T')[0],
                records: [],
                totalSpent: 0,
                loyaltyPoints: 0,
                deliveredAmounts: [],
                balance: 0
            };
            
            saveData();
            renderClients();
            closeModal('clientModal');
            
            alert('تم إضافة العميل بنجاح!');
        }

        function addEmployee(e) {
            e.preventDefault();
            
            const name = document.getElementById('employeeName').value;
            const phone = document.getElementById('employeePhone').value;
            const salary = parseFloat(document.getElementById('employeeSalary').value);
            const position = document.getElementById('employeePosition').value;
            
            employees[name] = {
                phone: phone,
                salary: salary,
                position: position,
                joinDate: new Date().toISOString().split('T')[0],
                records: []
            };
            
            saveData();
            renderEmployees();
            closeModal('employeeModal');
            
            alert('تم إضافة الموظف بنجاح!');
        }

        function addSupplier(e) {
            e.preventDefault();
            
            const name = document.getElementById('supplierName').value;
            const phone = document.getElementById('supplierPhone').value;
            const email = document.getElementById('supplierEmail').value;
            const address = document.getElementById('supplierAddress').value;
            
            suppliers[name] = {
                phone: phone,
                email: email,
                address: address,
                joinDate: new Date().toISOString().split('T')[0]
            };
            
            saveData();
            renderSuppliers();
            closeModal('supplierModal');
            
            alert('تم إضافة المورد بنجاح!');
        }

        function addDebtor(e) {
            e.preventDefault();
            
            const name = document.getElementById('debtorName').value;
            const phone = document.getElementById('debtorPhone').value;
            const amount = parseFloat(document.getElementById('debtorAmount').value);
            const dueDate = document.getElementById('debtorDueDate').value;
            
            debtors[name] = {
                phone: phone,
                amount: amount,
                dueDate: dueDate,
                joinDate: new Date().toISOString().split('T')[0]
            };
            
            saveData();
            renderDebtors();
            closeModal('debtorModal');
            
            alert('تم إضافة المدين بنجاح!');
        }

        function addInvoice(e) {
            e.preventDefault();
            
            const client = document.getElementById('invoiceClient').value;
            const date = document.getElementById('invoiceDate').value;
            
            const invoice = {
                client: client,
                date: date,
                items: [],
                total: 0
            };
            
            invoices.push(invoice);
            saveData();
            closeModal('invoiceModal');
            
            alert('تم إنشاء الفاتورة بنجاح!');
        }

        function addVoucher(e) {
            e.preventDefault();
            
            const type = document.getElementById('voucherType').value;
            const amount = parseFloat(document.getElementById('voucherAmount').value);
            const date = document.getElementById('voucherDate').value;
            
            const voucher = {
                type: type,
                amount: amount,
                date: date
            };
            
            vouchers.push(voucher);
            saveData();
            closeModal('voucherModal');
            
            alert('تم إنشاء السند بنجاح!');
        }

        function addTransfer(e) {
            e.preventDefault();
            
            const from = document.getElementById('transferFrom').value;
            const to = document.getElementById('transferTo').value;
            const amount = parseFloat(document.getElementById('transferAmount').value);
            const date = document.getElementById('transferDate').value;
            
            const transfer = {
                from: from,
                to: to,
                amount: amount,
                date: date
            };
            
            transfers.push(transfer);
            saveData();
            closeModal('transferModal');
            
            alert('تم إنشاء الحوالة بنجاح!');
        }

        function addInvoiceItem() {
            const itemsContainer = document.getElementById('invoiceItems');
            const newItem = document.createElement('div');
            newItem.className = 'amount-input-group';
            newItem.innerHTML = `
                <input type="text" class="form-control" placeholder="اسم الصنف">
                <input type="number" class="form-control" placeholder="الكمية" step="1">
                <input type="number" class="form-control" placeholder="السعر" step="0.01">
                <button type="button" class="btn btn-outline" onclick="this.parentElement.remove()">-</button>
            `;
            itemsContainer.appendChild(newItem);
        }

        function renderClients() {
            const container = document.getElementById('clientsList');
            container.innerHTML = '';
            
            if (Object.keys(clients).length === 0) {
                container.innerHTML = `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-details">
                                <div class="item-name">لا يوجد عملاء</div>
                                <div class="item-desc">قم بإضافة عميل جديد</div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            for (const client in clients) {
                const clientElement = document.createElement('div');
                clientElement.className = 'list-item';
                clientElement.onclick = () => showClientRecords(client);
                clientElement.innerHTML = `
                    <div class="client-header">
                        <div class="item-info">
                            <div class="item-icon">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="item-details">
                                <div class="item-name">${client}</div>
                                <div class="item-desc">${clients[client].phone} - ${clients[client].loyaltyPoints} نقطة</div>
                            </div>
                        </div>
                        <div class="client-actions">
                            <button class="contacts-btn" onclick="event.stopPropagation(); addClientToContacts('${client}')" title="إضافة إلى جهات الاتصال">
                                <i class="fas fa-address-book"></i>
                            </button>
                            <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="event.stopPropagation(); deleteClient('${client}')">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                            <i class="fas fa-chevron-left"></i>
                        </div>
                    </div>
                `;
                container.appendChild(clientElement);
            }
        }

        function renderSuppliers() {
            const container = document.getElementById('suppliersList');
            container.innerHTML = '';
            
            if (Object.keys(suppliers).length === 0) {
                container.innerHTML = `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-details">
                                <div class="item-name">لا يوجد موردين</div>
                                <div class="item-desc">قم بإضافة مورد جديد</div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            for (const supplier in suppliers) {
                const supplierElement = document.createElement('div');
                supplierElement.className = 'list-item';
                supplierElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">${supplier}</div>
                            <div class="item-desc">${suppliers[supplier].phone}</div>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;" onclick="deleteSupplier('${supplier}')">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                        <i class="fas fa-chevron-left"></i>
                    </div>
                `;
                container.appendChild(supplierElement);
            }
        }

        function renderDebtors() {
            const container = document.getElementById('debtorsList');
            container.innerHTML = '';
            
            if (Object.keys(debtors).length === 0) {
                container.innerHTML = `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-details">
                                <div class="item-name">لا يوجد مدينين</div>
                                <div class="item-desc">قم بإضافة مدين جديد</div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            for (const debtor in debtors) {
                const debtorElement = document.createElement('div');
                debtorElement.className = 'list-item';
                debtorElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">${debtor}</div>
                            <div class="item-desc">${debtors[debtor].phone} - ${debtors[debtor].dueDate}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="debt-amount">${debtors[debtor].amount.toFixed(2)} ر.س</span>
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="deleteDebtor('${debtor}')">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                container.appendChild(debtorElement);
            }
        }

        function addClientToContacts(clientName) {
            const client = clients[clientName];
            
            const existingContact = contacts.find(contact => contact.phone === client.phone);
            if (existingContact) {
                alert('هذا العميل موجود بالفعل في جهات الاتصال!');
                return;
            }
            
            contacts.push({
                name: clientName,
                phone: client.phone,
                email: client.email || '',
                address: client.address || ''
            });
            
            saveData();
            alert(`تم إضافة ${clientName} إلى جهات الاتصال بنجاح!`);
        }

        function renderEmployees() {
            const container = document.getElementById('employeesList');
            container.innerHTML = '';
            
            if (Object.keys(employees).length === 0) {
                container.innerHTML = `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-details">
                                <div class="item-name">لا يوجد موظفين</div>
                                <div class="item-desc">قم بإضافة موظف جديد</div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            for (const employee in employees) {
                const employeeElement = document.createElement('div');
                employeeElement.className = 'list-item';
                employeeElement.onclick = () => showEmployeeRecords(employee);
                employeeElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">${employee}</div>
                            <div class="item-desc">${employees[employee].position} - ${employees[employee].salary.toFixed(2)} ر.س</div>
                        </div>
                    </div>
                    <div>
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;" onclick="event.stopPropagation(); deleteEmployee('${employee}')">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                        <i class="fas fa-chevron-left"></i>
                    </div>
                `;
                container.appendChild(employeeElement);
            }
        }

        function deleteClient(clientName) {
            if (confirm(`هل أنت متأكد من حذف العميل "${clientName}"؟ سيتم حذف جميع سجلاته أيضًا.`)) {
                delete clients[clientName];
                saveData();
                renderClients();
                alert('تم حذف العميل بنجاح!');
            }
        }

        function deleteEmployee(employeeName) {
            if (confirm(`هل أنت متأكد من حذف الموظف "${employeeName}"؟ سيتم حذف جميع سجلاته أيضًا.`)) {
                delete employees[employeeName];
                saveData();
                renderEmployees();
                alert('تم حذف الموظف بنجاح!');
            }
        }

        function deleteSupplier(supplierName) {
            if (confirm(`هل أنت متأكد من حذف المورد "${supplierName}"؟`)) {
                delete suppliers[supplierName];
                saveData();
                renderSuppliers();
                alert('تم حذف المورد بنجاح!');
            }
        }

        function deleteDebtor(debtorName) {
            if (confirm(`هل أنت متأكد من حذف المدين "${debtorName}"؟`)) {
                delete debtors[debtorName];
                saveData();
                renderDebtors();
                alert('تم حذف المدين بنجاح!');
            }
        }

        function deleteClientAccount() {
            if (!currentClient) return;
            
            if (confirm(`هل أنت متأكد من حذف حساب العميل "${currentClient}" بالكامل؟`)) {
                delete clients[currentClient];
                saveData();
                showPage('clients');
                alert('تم حذف حساب العميل بالكامل!');
            }
        }

        function deleteEmployeeAccount() {
            if (!currentEmployee) return;
            
            if (confirm(`هل أنت متأكد من حذف حساب الموظف "${currentEmployee}" بالكامل؟`)) {
                delete employees[currentEmployee];
                saveData();
                showPage('employees');
                alert('تم حذف حساب الموظف بالكامل!');
            }
        }

        function deleteAllData() {
            if (confirm('هل أنت متأكد من حذف جميع البيانات؟ هذا الإجراء لا يمكن التراجع عنه.')) {
                clients = {};
                employees = {};
                suppliers = {};
                debtors = {};
                contacts = [];
                deliveredAmounts = [];
                invoices = [];
                vouchers = [];
                transfers = [];
                saveData();
                renderClients();
                renderEmployees();
                renderSuppliers();
                renderDebtors();
                renderDeliveredAmounts();
                alert('تم حذف جميع البيانات بنجاح!');
            }
        }

        function showClientRecords(clientName) {
            currentClient = clientName;
            document.getElementById('clientRecordsTitle').textContent = `سجل العميل: ${clientName}`;
            showPage('client-records');
            renderClientRecords();
            renderClientDeliveredAmounts();
            updateClientBalance();
        }

        function showEmployeeRecords(employeeName) {
            currentEmployee = employeeName;
            document.getElementById('employeeRecordsTitle').textContent = `سجل الموظف: ${employeeName}`;
            showPage('employee-records');
            renderEmployeeRecords();
        }

        function renderClientRecords() {
            if (!currentClient || !clients[currentClient]) return;
            
            const container = document.getElementById('clientRecordsTable');
            container.innerHTML = '';
            
            const client = clients[currentClient];
            let total = 0;
            
            if (client.records && client.records.length > 0) {
                client.records.forEach((record, index) => {
                    const points = Math.floor(record.value / 10);
                    total += record.value;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.item}</td>
                        <td>${record.value.toFixed(2)}</td>
                        <td>${record.date}</td>
                        <td>+${points}</td>
                        <td>
                            <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="deleteClientRecord(${index})">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </td>
                    `;
                    container.appendChild(row);
                });
            } else {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 15px;">لا توجد معاملات مسجلة</td>
                    </tr>
                `;
            }
            
            document.getElementById('clientTotal').textContent = `الإجمالي: ${total.toFixed(2)}`;
        }

        function renderEmployeeRecords() {
            if (!currentEmployee || !employees[currentEmployee]) return;
            
            const container = document.getElementById('employeeRecordsTable');
            container.innerHTML = '';
            
            const employee = employees[currentEmployee];
            let total = 0;
            
            if (employee.records && employee.records.length > 0) {
                employee.records.forEach((record, index) => {
                    total += record.value;
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${record.item}</td>
                        <td>${record.value.toFixed(2)}</td>
                        <td>${record.date}</td>
                        <td>-</td>
                        <td>
                            <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="deleteEmployeeRecord(${index})">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </td>
                    `;
                    container.appendChild(row);
                });
            } else {
                container.innerHTML = `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 15px;">لا توجد معاملات مسجلة</td>
                    </tr>
                `;
            }
            
            document.getElementById('employeeTotal').textContent = `الإجمالي: ${total.toFixed(2)}`;
        }

        function addClientRecord() {
            if (!currentClient) return;
            
            const item = document.getElementById('itemName').value;
            const value = parseFloat(document.getElementById('itemValue').value);
            
            if (!item || !value) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            const points = Math.floor(value / 10);
            
            if (!clients[currentClient].records) {
                clients[currentClient].records = [];
            }
            
            clients[currentClient].records.push({
                item: item,
                value: value,
                date: dateStr
            });
            
            clients[currentClient].totalSpent += value;
            clients[currentClient].loyaltyPoints += points;
            
            document.getElementById('itemName').value = '';
            document.getElementById('itemValue').value = '';
            
            saveData();
            renderClientRecords();
            updateClientBalance();
            alert('تم إضافة المعاملة بنجاح!');
        }

        function addEmployeeRecord() {
            if (!currentEmployee) return;
            
            const item = document.getElementById('employeeItemName').value;
            const value = parseFloat(document.getElementById('employeeItemValue').value);
            
            if (!item || !value) {
                alert('يرجى ملء جميع الحقول');
                return;
            }
            
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            
            if (!employees[currentEmployee].records) {
                employees[currentEmployee].records = [];
            }
            
            employees[currentEmployee].records.push({
                item: item,
                value: value,
                date: dateStr
            });
            
            document.getElementById('employeeItemName').value = '';
            document.getElementById('employeeItemValue').value = '';
            
            saveData();
            renderEmployeeRecords();
            alert('تم إضافة المعاملة بنجاح!');
        }

        function deleteClientRecord(index) {
            if (!currentClient || !confirm('هل أنت متأكد من حذف هذه المعاملة؟')) return;
            
            const record = clients[currentClient].records[index];
            const points = Math.floor(record.value / 10);
            
            clients[currentClient].totalSpent -= record.value;
            clients[currentClient].loyaltyPoints = Math.max(0, clients[currentClient].loyaltyPoints - points);
            clients[currentClient].records.splice(index, 1);
            
            saveData();
            renderClientRecords();
            updateClientBalance();
            alert('تم حذف المعاملة بنجاح!');
        }

        function deleteEmployeeRecord(index) {
            if (!currentEmployee || !confirm('هل أنت متأكد من حذف هذه المعاملة؟')) return;
            
            employees[currentEmployee].records.splice(index, 1);
            saveData();
            renderEmployeeRecords();
            alert('تم حذف المعاملة بنجاح!');
        }

        function sendClientStatement(method) {
            if (!currentClient) return;
            
            const client = clients[currentClient];
            let message = `كشف حساب العميل: ${currentClient}\n`;
            message += `رقم الهاتف: ${client.phone}\n`;
            if (client.email) message += `البريد الإلكتروني: ${client.email}\n`;
            message += `إجمالي المشتريات: ${client.totalSpent.toFixed(2)} ر.س\n`;
            message += `نقاط الولاء: ${client.loyaltyPoints} نقطة\n`;
            
            let totalDelivered = 0;
            if (client.deliveredAmounts && client.deliveredAmounts.length > 0) {
                message += `\nالمبالغ المسلمة:\n`;
                client.deliveredAmounts.forEach(amount => {
                    message += `- ${amount.amount.toFixed(2)} ر.س (${amount.date})\n`;
                    totalDelivered += amount.amount;
                });
            }
            
            const balance = client.totalSpent - totalDelivered;
            message += `\nإجمالي المبالغ المسلمة: ${totalDelivered.toFixed(2)} ر.س\n`;
            message += `الرصيد المتبقي: ${balance.toFixed(2)} ر.س\n\n`;
            
            message += `التفاصيل:\n`;
            
            if (client.records && client.records.length > 0) {
                client.records.forEach(record => {
                    message += `- ${record.item}: ${record.value.toFixed(2)} ر.س (${record.date})\n`;
                });
            } else {
                message += `لا توجد معاملات مسجلة\n`;
            }
            
            message += `\nشكراً لتعاملكم معنا`;
            
            if (method === 'whatsapp') {
                const phone = client.phone.replace(/\D/g, '');
                const url = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
                window.open(url, '_blank');
            } else if (method === 'sms') {
                alert(`جاري إرسال رسالة نصية إلى ${client.phone}\n\n${message}`);
            }
        }

        function loadContacts() {
        }

        function renderContacts() {
            const container = document.getElementById('contactsList');
            container.innerHTML = '';
            
            if (contacts.length === 0) {
                container.innerHTML = `
                    <div class="contact-item">
                        <div class="contact-info">
                            <div class="contact-name">لا توجد جهات اتصال</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            contacts.forEach((contact, index) => {
                const contactElement = document.createElement('div');
                contactElement.className = 'contact-item';
                contactElement.onclick = () => selectContact(contact);
                contactElement.innerHTML = `
                    <div class="contact-avatar">${contact.name.charAt(0)}</div>
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-phone">${contact.phone}</div>
                    </div>
                    <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="event.stopPropagation(); deleteContact(${index})">
                        <i class="fas fa-trash"></i> حذف
                    </button>
                `;
                container.appendChild(contactElement);
            });
        }

        function filterContacts() {
            const query = document.getElementById('contactSearch').value.toLowerCase();
            const contactItems = document.querySelectorAll('.contact-item');
            
            contactItems.forEach(item => {
                const name = item.querySelector('.contact-name').textContent.toLowerCase();
                const phone = item.querySelector('.contact-phone').textContent.toLowerCase();
                
                if (name.includes(query) || phone.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        function selectContact(contact) {
            document.getElementById('clientPhone').value = contact.phone;
            document.getElementById('clientName').value = contact.name;
            closeModal('contactsModal');
            showClientModal();
        }

        function addNewContact() {
            const name = prompt('أدخل اسم جهة الاتصال:');
            if (name && name.trim()) {
                const phone = prompt('أدخل رقم الهاتف:');
                if (phone && phone.trim()) {
                    contacts.push({
                        name: name,
                        phone: phone
                    });
                    saveData();
                    renderContacts();
                    alert('تم إضافة جهة الاتصال بنجاح!');
                }
            }
        }

        function deleteContact(index) {
            if (confirm('هل أنت متأكد من حذف جهة الاتصال هذه؟')) {
                contacts.splice(index, 1);
                saveData();
                renderContacts();
                alert('تم حذف جهة الاتصال بنجاح!');
            }
        }

        function accessDeviceContacts() {
            if ('contacts' in navigator && 'select' in navigator.contacts) {
                navigator.contacts.select(['name', 'tel'])
                    .then(contacts => {
                        if (contacts && contacts.length > 0) {
                            const contact = contacts[0];
                            alert(`تم اختيار جهة الاتصال: ${contact.name} - ${contact.tel ? contact.tel[0] : 'لا يوجد رقم'}`);
                            
                            document.getElementById('clientPhone').value = contact.tel ? contact.tel[0] : '';
                            document.getElementById('clientName').value = contact.name || '';
                            
                            showClientModal();
                        } else {
                            alert('لم يتم اختيار أي جهة اتصال');
                        }
                    })
                    .catch(error => {
                        console.error('خطأ في الوصول إلى جهات الاتصال:', error);
                        alert('عذراً، لا يمكن الوصول إلى جهات اتصال الجهاز. تأكد من السماح للتطبيق بالوصول إلى جهات الاتصال.');
                    });
            } else {
                alert('عذراً، متصفحك لا يدعم واجهة برمجة تطبيقات جهات الاتصال. يمكنك إضافة جهات الاتصال يدوياً.');
            }
        }

        function accessDrive() {
            alert('جاري الوصول إلى Google Drive...');
        }

        function searchData() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (query.length > 2) {
                alert(`جاري البحث عن: ${query}`);
            }
        }

        function generateReport(type) {
            alert(`جاري إنشاء تقرير ${type}...`);
        }

        function createBackup() {
            const backupData = {
                clients: clients,
                employees: employees,
                suppliers: suppliers,
                debtors: debtors,
                contacts: contacts,
                deliveredAmounts: deliveredAmounts,
                invoices: invoices,
                vouchers: vouchers,
                transfers: transfers,
                timestamp: new Date().toISOString()
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(backupData));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "نسخة_احتياطية_المحاسب_الذكي.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            
            alert('تم إنشاء النسخة الاحتياطية بنجاح!');
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const backupData = JSON.parse(event.target.result);
                        
                        if (confirm('هل أنت متأكد من استعادة النسخة الاحتياطية؟ سيتم استبدال جميع البيانات الحالية.')) {
                            clients = backupData.clients || {};
                            employees = backupData.employees || {};
                            suppliers = backupData.suppliers || {};
                            debtors = backupData.debtors || {};
                            contacts = backupData.contacts || [];
                            deliveredAmounts = backupData.deliveredAmounts || [];
                            invoices = backupData.invoices || [];
                            vouchers = backupData.vouchers || [];
                            transfers = backupData.transfers || [];
                            
                            saveData();
                            renderClients();
                            renderEmployees();
                            renderSuppliers();
                            renderDebtors();
                            renderDeliveredAmounts();
                            alert('تم استعادة النسخة الاحتياطية بنجاح!');
                        }
                    } catch (error) {
                        alert('خطأ في استعادة النسخة الاحتياطية!');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function showDeveloperNotification() {
            document.getElementById('developerNotification').style.display = 'block';
        }

        function closeDeveloperNotification() {
            document.getElementById('developerNotification').style.display = 'none';
        }

        function addDeliveredAmount() {
            const amount = parseFloat(document.getElementById('amountValue').value);
            const client = document.getElementById('amountClient').value;
            
            if (!amount) {
                alert('يرجى إدخال المبلغ');
                return;
            }
            
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            
            deliveredAmounts.push({
                amount: amount,
                date: dateStr,
                client: client
            });
            
            document.getElementById('amountValue').value = '';
            
            saveData();
            renderDeliveredAmounts();
            alert('تم إضافة المبلغ المسلم بنجاح!');
        }

        function addClientDeliveredAmount() {
            if (!currentClient) return;
            
            const amount = parseFloat(document.getElementById('clientAmountValue').value);
            
            if (!amount) {
                alert('يرجى إدخال المبلغ');
                return;
            }
            
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            
            if (!clients[currentClient].deliveredAmounts) {
                clients[currentClient].deliveredAmounts = [];
            }
            
            clients[currentClient].deliveredAmounts.push({
                amount: amount,
                date: dateStr
            });
            
            document.getElementById('clientAmountValue').value = '';
            
            saveData();
            renderClientDeliveredAmounts();
            updateClientBalance();
            alert('تم إضافة المبلغ المسلم للعميل بنجاح!');
        }

        function renderDeliveredAmounts() {
            const container = document.getElementById('deliveredAmountsList');
            container.innerHTML = '';
            
            if (deliveredAmounts.length === 0) {
                container.innerHTML = `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-details">
                                <div class="item-name">لا توجد مبالغ مسلمة</div>
                                <div class="item-desc">قم بإضافة مبلغ مسلم جديد</div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            let totalAmount = 0;
            
            deliveredAmounts.forEach((amount, index) => {
                totalAmount += amount.amount;
                
                const amountElement = document.createElement('div');
                amountElement.className = 'list-item';
                amountElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">${amount.amount.toFixed(2)} ر.س</div>
                            <div class="item-desc">${amount.date} ${amount.client ? `- ${amount.client}` : ''}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="delivered-amount">
                            <i class="fas fa-check-circle"></i> ${amount.amount.toFixed(2)} ر.س
                        </span>
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="deleteDeliveredAmount(${index})">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                container.appendChild(amountElement);
            });
            
            const totalElement = document.createElement('div');
            totalElement.className = 'list-item';
            totalElement.style.background = 'var(--success)';
            totalElement.style.color = 'white';
            totalElement.style.fontWeight = 'bold';
            totalElement.innerHTML = `
                <div class="item-info">
                    <div class="item-details">
                        <div class="item-name">إجمالي المبالغ المسلمة</div>
                    </div>
                </div>
                <div>${totalAmount.toFixed(2)} ر.س</div>
            `;
            container.appendChild(totalElement);
        }

        function renderClientDeliveredAmounts() {
            if (!currentClient || !clients[currentClient]) return;
            
            const container = document.getElementById('clientDeliveredAmountsList');
            container.innerHTML = '';
            
            const client = clients[currentClient];
            
            if (!client.deliveredAmounts || client.deliveredAmounts.length === 0) {
                container.innerHTML = `
                    <div class="list-item">
                        <div class="item-info">
                            <div class="item-details">
                                <div class="item-name">لا توجد مبالغ مسلمة</div>
                                <div class="item-desc">قم بإضافة مبلغ مسلم جديد</div>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            let totalAmount = 0;
            
            client.deliveredAmounts.forEach((amount, index) => {
                totalAmount += amount.amount;
                
                const amountElement = document.createElement('div');
                amountElement.className = 'list-item';
                amountElement.innerHTML = `
                    <div class="item-info">
                        <div class="item-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="item-details">
                            <div class="item-name">${amount.amount.toFixed(2)} ر.س</div>
                            <div class="item-desc">${amount.date}</div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="delivered-amount">
                            <i class="fas fa-check-circle"></i> ${amount.amount.toFixed(2)} ر.س
                        </span>
                        <button class="btn btn-outline" style="padding: 5px 10px; font-size: 12px;" onclick="deleteClientDeliveredAmount(${index})">
                            <i class="fas fa-trash"></i> حذف
                        </button>
                    </div>
                `;
                container.appendChild(amountElement);
            });
            
            const totalElement = document.createElement('div');
            totalElement.className = 'list-item';
            totalElement.style.background = 'var(--success)';
            totalElement.style.color = 'white';
            totalElement.style.fontWeight = 'bold';
            totalElement.innerHTML = `
                <div class="item-info">
                    <div class="item-details">
                        <div class="item-name">إجمالي المبالغ المسلمة</div>
                    </div>
                </div>
                <div>${totalAmount.toFixed(2)} ر.س</div>
            `;
            container.appendChild(totalElement);
        }

        function deleteDeliveredAmount(index) {
            if (confirm('هل أنت متأكد من حذف هذا المبلغ المسلم؟')) {
                deliveredAmounts.splice(index, 1);
                saveData();
                renderDeliveredAmounts();
                alert('تم حذف المبلغ المسلم بنجاح!');
            }
        }

        function deleteClientDeliveredAmount(index) {
            if (!currentClient || !confirm('هل أنت متأكد من حذف هذا المبلغ المسلم؟')) return;
            
            clients[currentClient].deliveredAmounts.splice(index, 1);
            saveData();
            renderClientDeliveredAmounts();
            updateClientBalance();
            alert('تم حذف المبلغ المسلم للعميل بنجاح!');
        }

        function updateClientBalance() {
            if (!currentClient || !clients[currentClient]) return;
            
            const client = clients[currentClient];
            
            let totalPurchases = 0;
            if (client.records && client.records.length > 0) {
                client.records.forEach(record => {
                    totalPurchases += record.value;
                });
            }
            
            let totalDelivered = 0;
            if (client.deliveredAmounts && client.deliveredAmounts.length > 0) {
                client.deliveredAmounts.forEach(amount => {
                    totalDelivered += amount.amount;
                });
            }
            
            const balance = totalPurchases - totalDelivered;
            
            const balanceElement = document.getElementById('clientBalance');
            balanceElement.textContent = `${balance.toFixed(2)} ر.س`;
            
            if (balance > 0) {
                balanceElement.className = 'balance-amount balance-negative';
            } else if (balance < 0) {
                balanceElement.className = 'balance-amount balance-positive';
            } else {
                balanceElement.className = 'balance-amount';
            }
            
            clients[currentClient].balance = balance;
            saveData();
        }

        function showDeliveredAmounts() {
            alert('جاري عرض جميع المبالغ المسلمة...');
        }

        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
    </script>
</body>
</html>